<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JACK AI - BY T·∫§N KHANG</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
        }

        /* Key Container Styles */
        .key-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 2.5rem;
            border-radius: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            width: 90%;
            max-width: 450px;
            text-align: center;
            animation: slideUp 0.5s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        body.dark-mode .key-container {
            background: rgba(30, 41, 59, 0.95);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .logo {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            border-radius: 50%;
            margin: 0 auto 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            color: white;
            box-shadow: 0 20px 30px -10px rgba(37, 99, 235, 0.5);
        }

        .key-container h1 {
            font-size: 2.2rem;
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .key-container h2 {
            color: #64748b;
            font-size: 1rem;
            margin-bottom: 2rem;
        }

        body.dark-mode .key-container h2 {
            color: #94a3b8;
        }

        .input-group {
            margin: 1.5rem 0;
            position: relative;
        }

        .input-group input {
            width: 100%;
            padding: 1.2rem 1.5rem;
            border: 2px solid #e2e8f0;
            border-radius: 50px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }

        body.dark-mode .input-group input {
            background: #1e293b;
            border-color: #334155;
            color: white;
        }

        .input-group input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }

        .btn {
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            color: white;
            border: none;
            padding: 1.2rem 2rem;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 10px 20px -5px rgba(37, 99, 235, 0.4);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 30px -5px rgba(37, 99, 235, 0.6);
        }

        .btn:active {
            transform: translateY(0);
        }

        .demo-text {
            margin-top: 2rem;
            padding: 1rem;
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 20px;
            color: #475569;
            font-size: 0.9rem;
        }

        body.dark-mode .demo-text {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            color: #94a3b8;
        }

        /* Activate Windows */
        .activate-windows {
            margin-top: 1.5rem;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 30px;
            font-size: 0.8rem;
            color: #64748b;
        }

        body.dark-mode .activate-windows {
            background: rgba(255, 255, 255, 0.05);
            color: #94a3b8;
        }

        /* Main Container */
        .main-container {
            width: 100%;
            height: 100vh;
            display: none;
            background: #f8fafc;
        }

        body.dark-mode .main-container {
            background: #0f172a;
        }

        .chat-interface {
            display: flex;
            height: 100%;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 320px;
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            color: white;
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .avatar {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            border-radius: 50%;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            border: 3px solid white;
        }

        .sidebar-header h3 {
            font-size: 1.5rem;
            margin-bottom: 0.3rem;
        }

        .sidebar-header p {
            color: #94a3b8;
            font-size: 0.9rem;
        }

        .user-info-card {
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            margin: 1rem;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .user-info-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin: 0.8rem 0;
            font-size: 0.9rem;
        }

        .user-info-item i {
            width: 20px;
            color: #94a3b8;
        }

        .social-login {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .social-btn {
            flex: 1;
            min-width: 40px;
            height: 40px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .social-btn:hover {
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            transform: translateY(-2px);
        }

        .chat-history {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }

        .chat-history h4 {
            padding: 0 0.5rem;
            margin-bottom: 1rem;
            color: #94a3b8;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .history-item {
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .history-item .title {
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .history-item .time {
            font-size: 0.7rem;
            color: #94a3b8;
        }

        .admin-chat-btn {
            margin: 1rem;
            padding: 1rem;
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            border: none;
            border-radius: 15px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .admin-chat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(37, 99, 235, 0.5);
        }

        /* Main Chat Area */
        .main-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #ffffff;
        }

        body.dark-mode .main-chat {
            background: #1e293b;
        }

        .chat-header {
            padding: 1.5rem 2rem;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        body.dark-mode .chat-header {
            background: rgba(30, 41, 59, 0.8);
            border-color: #334155;
        }

        .header-info h2 {
            font-size: 1.5rem;
            color: #2563eb;
            margin-bottom: 0.3rem;
        }

        .header-info p {
            color: #64748b;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .online-dot {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            display: inline-block;
        }

        .header-actions {
            display: flex;
            gap: 0.8rem;
        }

        .header-btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 30px;
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(37, 99, 235, 0.5);
        }

        /* Messages Area */
        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .message {
            max-width: 80%;
            padding: 1rem 1.5rem;
            border-radius: 20px;
            animation: messageIn 0.3s ease;
            line-height: 1.6;
            position: relative;
        }

        @keyframes messageIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .bot-message {
            background: #f1f5f9;
            color: #0f172a;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }

        body.dark-mode .bot-message {
            background: #334155;
            color: white;
        }

        .thinking-badge {
            display: inline-block;
            padding: 0.3rem 1rem;
            border-radius: 30px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .message-time {
            font-size: 0.7rem;
            margin-top: 0.5rem;
            opacity: 0.7;
            text-align: right;
        }

        /* Input Area */
        .input-area {
            padding: 1.5rem 2rem;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-top: 1px solid #e2e8f0;
        }

        body.dark-mode .input-area {
            background: rgba(30, 41, 59, 0.8);
            border-color: #334155;
        }

        .thinking-modes {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 0.5rem 1.2rem;
            border: 2px solid #e2e8f0;
            border-radius: 30px;
            background: white;
            color: #475569;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            font-weight: 500;
        }

        body.dark-mode .mode-btn {
            background: #1e293b;
            border-color: #334155;
            color: #94a3b8;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            border-color: transparent;
            color: white;
        }

        .input-container {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
        }

        .input-container textarea {
            flex: 1;
            padding: 1rem 1.5rem;
            border: 2px solid #e2e8f0;
            border-radius: 30px;
            resize: none;
            font-size: 1rem;
            max-height: 150px;
            overflow-y: auto;
            transition: all 0.3s;
            background: white;
        }

        body.dark-mode .input-container textarea {
            background: #1e293b;
            border-color: #334155;
            color: white;
        }

        .input-container textarea:focus {
            outline: none;
            border-color: #2563eb;
        }

        .input-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            width: 45px;
            height: 45px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .upload-preview {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .preview-item {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            border: 2px solid #2563eb;
        }

        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-item button {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: none;
            background: red;
            color: white;
            cursor: pointer;
            font-size: 12px;
        }

        .quick-actions {
            display: flex;
            gap: 0.8rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .quick-action {
            padding: 0.5rem 1.2rem;
            border: none;
            border-radius: 30px;
            background: #f1f5f9;
            color: #475569;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        body.dark-mode .quick-action {
            background: #334155;
            color: #e2e8f0;
        }

        .quick-action:hover {
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            color: white;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2.5rem;
            border-radius: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            animation: modalIn 0.3s ease;
        }

        body.dark-mode .modal-content {
            background: #1e293b;
            color: white;
        }

        @keyframes modalIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal-header {
            margin-bottom: 2rem;
        }

        .modal-header h2 {
            color: #2563eb;
            margin-bottom: 0.5rem;
        }

        .admin-messages {
            max-height: 300px;
            overflow-y: auto;
            margin: 1rem 0;
            padding: 1rem;
            background: #f1f5f9;
            border-radius: 15px;
        }

        body.dark-mode .admin-messages {
            background: #334155;
        }

        .modal-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            margin: 1rem 0;
        }

        body.dark-mode .modal-input {
            background: #1e293b;
            border-color: #334155;
            color: white;
        }

        .typing-indicator {
            display: flex;
            gap: 0.3rem;
            padding: 1rem 1.5rem;
            background: #f1f5f9;
            border-radius: 20px;
            align-self: flex-start;
        }

        body.dark-mode .typing-indicator {
            background: #334155;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #2563eb;
            border-radius: 50%;
            animation: typingBounce 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typingBounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -320px;
                z-index: 100;
                height: 100vh;
                transition: left 0.3s ease;
            }

            .sidebar.active {
                left: 0;
            }

            .message {
                max-width: 90%;
            }
        }
    </style>
</head>
<body>
    <!-- Key Container -->
    <div class="key-container" id="keyContainer">
        <div class="logo">J</div>
        <h1>JACK AI</h1>
        <h2>BY T·∫§N KHANG</h2>

        <div class="input-group">
            <input type="password" id="apiKey" placeholder="Nh·∫≠p OpenRouter API Key...">
        </div>

        <button class="btn" onclick="checkApiKey()">
            <span>üîç KI·ªÇM TRA KEY</span>
        </button>

        <div class="demo-text">
            <p>Nh·∫≠p m·∫≠t kh·∫©u 123 ƒë·ªÉ v√†o demo</p>
        </div>

        <div class="activate-windows">
            ‚öôÔ∏è Activate Windows ‚Ä¢ Go to Settings to activate Windows
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container" id="mainContainer">
        <div class="chat-interface">
            <!-- Sidebar -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <div class="avatar">J</div>
                    <h3>JACK AI</h3>
                    <p>Si√™u tr√≠ tu·ªá nh√¢n t·∫°o</p>
                </div>

                <div class="user-info-card" id="userInfoCard">
                    <div class="user-info-item">
                        <i>üë§</i>
                        <span id="userName">Kh√°ch</span>
                    </div>
                    <div class="user-info-item">
                        <i>üìß</i>
                        <span id="userEmail">Ch∆∞a ƒëƒÉng nh·∫≠p</span>
                    </div>
                    <div class="user-info-item">
                        <i>üé≠</i>
                        <span id="userRole">Vai tr√≤: user</span>
                    </div>
                    
                    <div class="social-login">
                        <button class="social-btn" onclick="loginWithGoogle()" title="ƒêƒÉng nh·∫≠p Google">
                            <span>G</span>
                        </button>
                        <button class="social-btn" onclick="loginWithFacebook()" title="ƒêƒÉng nh·∫≠p Facebook">
                            <span>f</span>
                        </button>
                        <button class="social-btn" onclick="loginWithTwitter()" title="ƒêƒÉng nh·∫≠p Twitter">
                            <span>ùïè</span>
                        </button>
                        <button class="social-btn" onclick="loginWithTiktok()" title="ƒêƒÉng nh·∫≠p TikTok">
                            <span>üéµ</span>
                        </button>
                    </div>
                </div>

                <div class="chat-history">
                    <h4>üìú L·ªäCH S·ª¨ CHAT</h4>
                    <div id="chatHistoryList">
                        <!-- Chat history will be loaded here -->
                    </div>
                </div>

                <button class="admin-chat-btn" onclick="openAdminChat()">
                    <i>üí¨</i> NH·∫ÆN TIN V·ªöI ADMIN
                </button>
            </div>

            <!-- Main Chat Area -->
            <div class="main-chat">
                <div class="chat-header">
                    <div class="header-info">
                        <h2>JACK N√® - Si√™u tr√≠ tu·ªá</h2>
                        <p>
                            <span class="online-dot"></span>
                            Online ‚Ä¢ S·∫µn s√†ng gi√∫p ƒë·ª° b·∫°n
                        </p>
                    </div>
                    <div class="header-actions">
                        <button class="header-btn" onclick="toggleSidebar()">
                            <i>‚ò∞</i> Menu
                        </button>
                        <button class="header-btn" onclick="toggleTheme()" id="themeToggle">
                            <i>üåô</i> Dark/Light
                        </button>
                    </div>
                </div>

                <div class="messages-area" id="messagesArea">
                    <!-- Messages will be displayed here -->
                </div>

                <div class="input-area">
                    <!-- Thinking Modes -->
                    <div class="thinking-modes">
                        <button class="mode-btn active" onclick="setThinkingMode('fast')" id="fastMode">
                            ‚ö° Suy nghƒ© nhanh
                        </button>
                        <button class="mode-btn" onclick="setThinkingMode('slow')" id="slowMode">
                            üê¢ Suy nghƒ© ch·∫≠m
                        </button>
                        <button class="mode-btn" onclick="setThinkingMode('deep')" id="deepMode">
                            üß† Th√¥ng minh
                        </button>
                    </div>

                    <!-- Upload Preview -->
                    <div class="upload-preview" id="uploadPreview"></div>

                    <!-- Input Container -->
                    <div class="input-container">
                        <textarea id="userInput" placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n... (Shift + Enter ƒë·ªÉ xu·ªëng d√≤ng)" rows="1"></textarea>
                        <div class="input-actions">
                            <button class="action-btn" onclick="uploadImage()" title="T·∫£i ·∫£nh l√™n">
                                üì∑
                            </button>
                            <button class="action-btn" onclick="uploadFile()" title="T·∫£i file l√™n">
                                üìé
                            </button>
                            <button class="action-btn" onclick="sendMessage()" title="G·ª≠i tin nh·∫Øn">
                                üì§
                            </button>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <button class="quick-action" onclick="quickQuestion('Gi·∫£i b√†i t·∫≠p to√°n cao c·∫•p')">To√°n cao c·∫•p</button>
                        <button class="quick-action" onclick="quickQuestion('Gi·∫£i th√≠ch neural network')">Neural network</button>
                        <button class="quick-action" onclick="quickQuestion('Thuy·∫øt t∆∞∆°ng ƒë·ªëi l√† g√¨?')">Thuy·∫øt t∆∞∆°ng ƒë·ªëi</button>
                        <button class="quick-action" onclick="quickQuestion('L·ªô tr√¨nh h·ªçc ML')">L·ªô tr√¨nh ML</button>
                        <button class="quick-action" onclick="quickQuestion('So s√°nh c√°c m√¥ h√¨nh AI')">So s√°nh AI</button>
                        <button class="quick-action" onclick="quickQuestion('Vi·∫øt code Fibonacci')">Code Fibonacci</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Chat Modal -->
    <div class="modal" id="adminChatModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üí¨ Chat v·ªõi Admin</h2>
                <p>Admin s·∫Ω ph·∫£n h·ªìi s·ªõm nh·∫•t c√≥ th·ªÉ</p>
            </div>
            
            <div class="admin-messages" id="adminMessages">
                <div class="message bot-message" style="max-width: 100%;">
                    <p>Ch√†o b·∫°n! B·∫°n c·∫ßn h·ªó tr·ª£ g√¨ t·ª´ admin?</p>
                    <div class="message-time">H·ªá th·ªëng</div>
                </div>
            </div>

            <div class="input-container" style="margin-top: 1rem;">
                <input type="text" id="adminMessageInput" class="modal-input" placeholder="Nh·∫≠p tin nh·∫Øn...">
                <button class="action-btn" onclick="sendAdminMessage()" style="width: 100%; margin-top: 0.5rem;">
                    G·ª≠i tin nh·∫Øn
                </button>
            </div>

            <button class="btn" style="margin-top: 1rem;" onclick="closeAdminChat()">ƒê√≥ng</button>
        </div>
    </div>

    <script>
        // Global variables
        let apiKey = '';
        let isDemo = false;
        let currentUser = null;
        let isAdmin = false;
        let currentThinkingMode = 'fast';
        let messages = [];
        let chatHistory = JSON.parse(localStorage.getItem('chatHistory') || '[]');
        let uploadedFiles = [];

        // Admin email
        const ADMIN_EMAIL = 'kl5823633@gmail.com';

        // Check API Key
        function checkApiKey() {
            const key = document.getElementById('apiKey').value;
            
            if (key === '123') {
                // Demo mode
                isDemo = true;
                apiKey = 'demo';
                showNotification('‚úÖ ƒêƒÉng nh·∫≠p demo th√†nh c√¥ng!', 'success');
                enterChat();
                return;
            }
            
            if (key.startsWith('sk-') || key.includes('openrouter')) {
                // Real API mode
                apiKey = key;
                checkRealKey(key);
            } else {
                showNotification('‚ùå API Key kh√¥ng h·ª£p l·ªá!', 'error');
            }
        }

        // Check real API key
        async function checkRealKey(key) {
            try {
                document.querySelector('.btn').innerHTML = '‚è≥ ƒêang ki·ªÉm tra...';
                
                const response = await fetch('https://openrouter.ai/api/v1/auth/key', {
                    headers: {
                        'Authorization': `Bearer ${key}`
                    }
                });
                
                if (response.ok) {
                    showNotification('‚úÖ Key h·ª£p l·ªá! ƒêang v√†o chat...', 'success');
                    enterChat();
                } else {
                    showNotification('‚ùå Key kh√¥ng h·ª£p l·ªá!', 'error');
                    document.querySelector('.btn').innerHTML = 'üîç KI·ªÇM TRA KEY';
                }
            } catch (error) {
                showNotification('‚ùå L·ªói k·∫øt n·ªëi!', 'error');
                document.querySelector('.btn').innerHTML = 'üîç KI·ªÇM TRA KEY';
            }
        }

        // Enter chat
        function enterChat() {
            document.getElementById('keyContainer').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'block';
            
            // Add welcome message
            const messagesArea = document.getElementById('messagesArea');
            
            if (isDemo) {
                messagesArea.innerHTML = `
                    <div class="message bot-message">
                        <span class="thinking-badge">üéâ DEMO MODE</span>
                        <p>Xin ch√†o! T√¥i l√† JACK AI - Si√™u tr√≠ tu·ªá nh√¢n t·∫°o do ƒë·ªôi ng≈© c·ªßa T·∫§N KHANG ph√°t tri·ªÉn v√† ho√†n th√†nh. C·∫£m ∆°n b·∫°n ƒë√£ truy c·∫≠p v√†o demo!</p>
                        <div class="message-time">${new Date().toLocaleTimeString()}</div>
                    </div>
                    <div class="message bot-message">
                        <span class="thinking-badge">‚ö° Suy nghƒ© nhanh</span>
                        <p>T√¥i c√≥ th·ªÉ gi√∫p b·∫°n gi·∫£i b√†i t·∫≠p, vi·∫øt code, tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ AI/ML v√† nhi·ªÅu h∆°n n·ªØa!</p>
                        <div class="message-time">${new Date().toLocaleTimeString()}</div>
                    </div>
                `;
            } else {
                messagesArea.innerHTML = `
                    <div class="message bot-message">
                        <span class="thinking-badge">üöÄ JACK AI</span>
                        <p>Xin ch√†o! T√¥i l√† JACK AI - Si√™u tr√≠ tu·ªá nh√¢n t·∫°o. T√¥i ƒë√£ s·∫µn s√†ng gi√∫p ƒë·ª° b·∫°n!</p>
                        <div class="message-time">${new Date().toLocaleTimeString()}</div>
                    </div>
                `;
            }
            
            loadChatHistory();
        }

        // Set thinking mode
        function setThinkingMode(mode) {
            currentThinkingMode = mode;
            
            // Update active button
            document.getElementById('fastMode').classList.remove('active');
            document.getElementById('slowMode').classList.remove('active');
            document.getElementById('deepMode').classList.remove('active');
            
            if (mode === 'fast') {
                document.getElementById('fastMode').classList.add('active');
                showNotification('‚ö° ƒê√£ chuy·ªÉn sang ch·∫ø ƒë·ªô suy nghƒ© nhanh', 'info');
            } else if (mode === 'slow') {
                document.getElementById('slowMode').classList.add('active');
                showNotification('üê¢ ƒê√£ chuy·ªÉn sang ch·∫ø ƒë·ªô suy nghƒ© ch·∫≠m', 'info');
            } else {
                document.getElementById('deepMode').classList.add('active');
                showNotification('üß† ƒê√£ chuy·ªÉn sang ch·∫ø ƒë·ªô th√¥ng minh', 'info');
            }
        }

        // Send message
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (!message && uploadedFiles.length === 0) {
                showNotification('Vui l√≤ng nh·∫≠p c√¢u h·ªèi!', 'warning');
                return;
            }

            // Add user message
            addMessage(message, 'user');
            input.value = '';

            // Show typing indicator
            showTypingIndicator();

            // Get AI response
            setTimeout(async () => {
                removeTypingIndicator();
                
                let response;
                if (isDemo) {
                    response = getDemoResponse(message);
                } else {
                    response = await getAIResponse(message);
                }
                
                addMessage(response, 'bot', currentThinkingMode);
                saveToHistory(message, response);
            }, 1000);
        }

        // Get AI response from OpenRouter
        async function getAIResponse(prompt) {
            try {
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'openai/gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'system',
                                content: `B·∫°n l√† JACK AI - Si√™u tr√≠ tu·ªá nh√¢n t·∫°o c·ªßa T·∫§N KHANG. B·∫°n th√¥ng minh nh∆∞ ChatGPT Plus, c√≥ kh·∫£ nƒÉng gi·∫£i b√†i t·∫≠p s√¢u, vi·∫øt code, v√† tr·∫£ l·ªùi m·ªçi c√¢u h·ªèi. Ch·∫ø ƒë·ªô suy nghƒ© hi·ªán t·∫°i: ${currentThinkingMode}`
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        temperature: currentThinkingMode === 'fast' ? 0.8 : currentThinkingMode === 'slow' ? 0.3 : 0.1,
                        max_tokens: currentThinkingMode === 'deep' ? 4000 : 2000
                    })
                });

                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('API Error:', error);
                return 'Xin l·ªói, ƒë√£ c√≥ l·ªói x·∫£y ra khi k·∫øt n·ªëi ƒë·∫øn API. Vui l√≤ng th·ª≠ l·∫°i sau!';
            }
        }

        // Get demo response
        function getDemoResponse(prompt) {
            const responses = {
                'to√°n': `ƒê·ªÉ gi·∫£i b√†i to√°n cao c·∫•p n√†y, ch√∫ng ta c·∫ßn √°p d·ª•ng c√°c c√¥ng th·ª©c sau:

1. ƒê·∫°o h√†m: f'(x) = lim(h‚Üí0) [f(x+h) - f(x)]/h
2. T√≠ch ph√¢n: ‚à´f(x)dx = F(x) + C
3. Gi·ªõi h·∫°n: lim(x‚Üía) f(x) = L

B·∫°n c√≥ th·ªÉ cho t√¥i b√†i to√°n c·ª• th·ªÉ ƒë·ªÉ gi·∫£i chi ti·∫øt kh√¥ng?`,
                'neural': 'Neural Network (M·∫°ng n∆°-ron) l√† m√¥ h√¨nh h·ªçc s√¢u l·∫•y c·∫£m h·ª©ng t·ª´ n√£o b·ªô con ng∆∞·ªùi. C·∫•u tr√∫c c∆° b·∫£n g·ªìm:\n\n‚Ä¢ Input layer: Nh·∫≠n d·ªØ li·ªáu ƒë·∫ßu v√†o\n‚Ä¢ Hidden layers: X·ª≠ l√Ω ƒë·∫∑c tr∆∞ng\n‚Ä¢ Output layer: ƒê∆∞a ra k·∫øt qu·∫£\n\nC√°c activation function ph·ªï bi·∫øn: ReLU, Sigmoid, Tanh',
                't∆∞∆°ng ƒë·ªëi': 'Thuy·∫øt t∆∞∆°ng ƒë·ªëi c·ªßa Einstein g·ªìm 2 ph·∫ßn:\n\n1. Thuy·∫øt t∆∞∆°ng ƒë·ªëi h·∫πp (1905): E = mc¬≤\n2. Thuy·∫øt t∆∞∆°ng ƒë·ªëi r·ªông (1915): L·ª±c h·∫•p d·∫´n l√† ƒë·ªô cong kh√¥ng-th·ªùi gian\n\nC√¥ng th·ª©c n·ªïi ti·∫øng: E = mc¬≤, trong ƒë√≥ E l√† nƒÉng l∆∞·ª£ng, m l√† kh·ªëi l∆∞·ª£ng, c l√† v·∫≠n t·ªëc √°nh s√°ng',
                'code fibonacci': `D∆∞·ªõi ƒë√¢y l√† code Fibonacci trong nhi·ªÅu ng√¥n ng·ªØ:

Python:
\`\`\`python
def fibonacci(n):
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

# In 10 s·ªë Fibonacci ƒë·∫ßu ti√™n
for i in range(10):
    print(fibonacci(i))
\`\`\`

JavaScript:
\`\`\`javascript
function fibonacci(n) {
    return n <= 1 ? n : fibonacci(n-1) + fibonacci(n-2);
}

// In 10 s·ªë Fibonacci ƒë·∫ßu ti√™n
for(let i = 0; i < 10; i++) {
    console.log(fibonacci(i));
}
\`\`\`

Java:
\`\`\`java
public static int fibonacci(int n) {
    if (n <= 1) return n;
    return fibonacci(n-1) + fibonacci(n-2);
}
\`\`\``,
                'ml': 'L·ªô tr√¨nh h·ªçc Machine Learning:\n\n1. To√°n h·ªçc c∆° b·∫£n (ƒê·∫°i s·ªë tuy·∫øn t√≠nh, Gi·∫£i t√≠ch, X√°c su·∫•t th·ªëng k√™)\n2. Python v√† c√°c th∆∞ vi·ªán (NumPy, Pandas, Matplotlib)\n3. Machine Learning c∆° b·∫£n (Supervised/Unsupervised Learning)\n4. Deep Learning (Neural Networks, TensorFlow, PyTorch)\n5. C√°c m√¥ h√¨nh n√¢ng cao (CNN, RNN, Transformer)\n6. D·ª± √°n th·ª±c t·∫ø v√† Deployment'
            };
            
            for (let key in responses) {
                if (prompt.toLowerCase().includes(key)) {
                    return responses[key];
                }
            }
            
            return `T√¥i l√† JACK AI - Si√™u tr√≠ tu·ªá nh√¢n t·∫°o do ƒë·ªôi ng≈© T·∫§N KHANG ph√°t tri·ªÉn. T√¥i c√≥ th·ªÉ gi√∫p b·∫°n:

üìê Gi·∫£i b√†i t·∫≠p to√°n cao c·∫•p
üß† Gi·∫£i th√≠ch neural network
‚öõÔ∏è Thuy·∫øt t∆∞∆°ng ƒë·ªëi
üìö L·ªô tr√¨nh h·ªçc ML
ü§ñ So s√°nh c√°c m√¥ h√¨nh AI
üíª Vi·∫øt code (Fibonacci, c√°c thu·∫≠t to√°n kh√°c)

B·∫°n c·∫ßn t√¥i gi√∫p g√¨?`;
        }

        // Add message to chat
        function addMessage(content, sender, mode = 'fast') {
            const messagesArea = document.getElementById('messagesArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender === 'user' ? 'user-message' : 'bot-message'}`;
            
            let badgeText = '';
            if (sender === 'bot') {
                if (mode === 'fast') badgeText = '‚ö° Suy nghƒ© nhanh';
                else if (mode === 'slow') badgeText = 'üê¢ Suy nghƒ© ch·∫≠m';
                else badgeText = 'üß† Th√¥ng minh';
            }
            
            messageDiv.innerHTML = `
                ${sender === 'bot' ? `<span class="thinking-badge">${badgeText}</span>` : ''}
                <p>${content.replace(/\n/g, '<br>')}</p>
                <div class="message-time">${new Date().toLocaleTimeString()}</div>
            `;
            
            messagesArea.appendChild(messageDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        // Show typing indicator
        function showTypingIndicator() {
            const messagesArea = document.getElementById('messagesArea');
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator';
            indicator.id = 'typingIndicator';
            indicator.innerHTML = `
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            `;
            messagesArea.appendChild(indicator);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        // Remove typing indicator
        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // Upload image
        function uploadImage() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(readerEvent) {
                        addImagePreview(readerEvent.target.result);
                        uploadedFiles.push({
                            name: file.name,
                            data: readerEvent.target.result,
                            type: 'image'
                        });
                        showNotification(`üì∑ ƒê√£ t·∫£i l√™n: ${file.name}`, 'success');
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        // Upload file
        function uploadFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.pdf,.doc,.docx,.txt,.js,.py,.java,.cpp';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    uploadedFiles.push({
                        name: file.name,
                        type: 'file',
                        size: file.size
                    });
                    showNotification(`üìé ƒê√£ t·∫£i l√™n: ${file.name}`, 'success');
                    
                    // Add to input
                    const userInput = document.getElementById('userInput');
                    userInput.value += `[ƒê√£ t·∫£i l√™n: ${file.name}] `;
                }
            };
            input.click();
        }

        // Add image preview
        function addImagePreview(src) {
            const preview = document.getElementById('uploadPreview');
            const previewItem = document.createElement('div');
            previewItem.className = 'preview-item';
            previewItem.innerHTML = `
                <img src="${src}" alt="Preview">
                <button onclick="removePreview(this)">√ó</button>
            `;
            preview.appendChild(previewItem);
        }

        // Remove preview
        function removePreview(btn) {
            btn.parentElement.remove();
        }

        // Quick question
        function quickQuestion(question) {
            document.getElementById('userInput').value = question;
            sendMessage();
        }

        // Save to history
        function saveToHistory(question, answer) {
            const history = {
                id: Date.now(),
                question: question.substring(0, 30) + (question.length > 30 ? '...' : ''),
                time: new Date().toLocaleString(),
                messages: [
                    { role: 'user', content: question },
                    { role: 'assistant', content: answer }
                ]
            };
            
            chatHistory.unshift(history);
            if (chatHistory.length > 20) chatHistory.pop();
            
            localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
            loadChatHistory();
        }

        // Load chat history
        function loadChatHistory() {
            const historyList = document.getElementById('chatHistoryList');
            historyList.innerHTML = '';
            
            chatHistory.forEach(chat => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.onclick = () => loadChat(chat.id);
                item.innerHTML = `
                    <div class="title">${chat.question}</div>
                    <div class="time">${chat.time}</div>
                `;
                historyList.appendChild(item);
            });
        }

        // Load specific chat
        function loadChat(chatId) {
            const chat = chatHistory.find(c => c.id === chatId);
            if (chat) {
                const messagesArea = document.getElementById('messagesArea');
                messagesArea.innerHTML = '';
                
                chat.messages.forEach(msg => {
                    addMessage(msg.content, msg.role === 'user' ? 'user' : 'bot');
                });
            }
        }

        // Login functions
        function loginWithGoogle() {
            const email = prompt('Nh·∫≠p email Google c·ªßa b·∫°n:');
            if (email) {
                currentUser = {
                    name: email.split('@')[0],
                    email: email,
                    avatar: 'https://via.placeholder.com/100'
                };
                
                // Check if admin
                isAdmin = (email === ADMIN_EMAIL);
                
                updateUserInfo();
                showNotification(`‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng v·ªõi ${email}`, 'success');
            }
        }

        function loginWithFacebook() {
            showNotification('üîú T√≠nh nƒÉng ƒëang ph√°t tri·ªÉn', 'info');
        }

        function loginWithTwitter() {
            showNotification('üîú T√≠nh nƒÉng ƒëang ph√°t tri·ªÉn', 'info');
        }

        function loginWithTiktok() {
            showNotification('üîú T√≠nh nƒÉng ƒëang ph√°t tri·ªÉn', 'info');
        }

        // Update user info
        function updateUserInfo() {
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userEmail').textContent = currentUser.email;
                document.getElementById('userRole').textContent = `Vai tr√≤: ${isAdmin ? 'admin' : 'user'}`;
            }
        }

        // Open admin chat
        function openAdminChat() {
            document.getElementById('adminChatModal').classList.add('active');
        }

        // Close admin chat
        function closeAdminChat() {
            document.getElementById('adminChatModal').classList.remove('active');
        }

        // Send admin message
        function sendAdminMessage() {
            const input = document.getElementById('adminMessageInput');
            const message = input.value.trim();
            
            if (message) {
                const adminMessages = document.getElementById('adminMessages');
                
                // Add user message
                const userMsg = document.createElement('div');
                userMsg.className = 'message user-message';
                userMsg.style.maxWidth = '100%';
                userMsg.innerHTML = `
                    <p>${message}</p>
                    <div class="message-time">${new Date().toLocaleTimeString()}</div>
                `;
                adminMessages.appendChild(userMsg);
                
                // Add auto reply
                setTimeout(() => {
                    const adminReply = document.createElement('div');
                    adminReply.className = 'message bot-message';
                    adminReply.style.maxWidth = '100%';
                    adminReply.innerHTML = `
                        <p>C·∫£m ∆°n b·∫°n ƒë√£ li√™n h·ªá. Admin s·∫Ω ph·∫£n h·ªìi s·ªõm nh·∫•t c√≥ th·ªÉ!</p>
                        <div class="message-time">${new Date().toLocaleTimeString()}</div>
                    `;
                    adminMessages.appendChild(adminReply);
                    adminMessages.scrollTop = adminMessages.scrollHeight;
                }, 1000);
                
                input.value = '';
                adminMessages.scrollTop = adminMessages.scrollHeight;
            }
        }

        // Toggle theme
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const themeToggle = document.getElementById('themeToggle');
            if (document.body.classList.contains('dark-mode')) {
                themeToggle.innerHTML = '<i>‚òÄÔ∏è</i> Dark/Light';
                localStorage.setItem('theme', 'dark');
            } else {
                themeToggle.innerHTML = '<i>üåô</i> Dark/Light';
                localStorage.setItem('theme', 'light');
            }
        }

        // Toggle sidebar
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        // Show notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : type === 'warning' ? '#f59e0b' : '#3b82f6'};
                color: white;
                border-radius: 10px;
                box-shadow: 0 10px 20px rgba(0,0,0,0.2);
                z-index: 2000;
                animation: slideIn 0.3s ease;
                font-weight: 500;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Handle Enter key
        document.getElementById('userInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Load saved theme
        window.onload = function() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeToggle').innerHTML = '<i>‚òÄÔ∏è</i> Dark/Light';
            }
            
            // Load chat history
            loadChatHistory();
        };
    </script>
</body>
</html>
