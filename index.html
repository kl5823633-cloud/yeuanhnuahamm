<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JACK AI - BY T·∫§N KHANG</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --dark-bg: #1a1a2e;
            --dark-secondary: #16213e;
            --light-bg: #f8f9fa;
            --white: #ffffff;
            --shadow: 0 10px 40px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: var(--transition);
            margin: 0;
            padding: 0;
        }

        body.dark-mode {
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--dark-secondary) 100%);
        }

        /* Key Container Styles */
        .key-container {
            background: var(--white);
            padding: 2.5rem;
            border-radius: 30px;
            box-shadow: var(--shadow);
            width: 90%;
            max-width: 450px;
            text-align: center;
            animation: slideIn 0.5s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .dark-mode .key-container {
            background: #2d2d3d;
            color: var(--white);
            border-color: rgba(255,255,255,0.1);
        }

        .key-container h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .key-container h2 {
            color: #666;
            margin-bottom: 2rem;
            font-size: 1.2rem;
        }

        .dark-mode .key-container h2 {
            color: #aaa;
        }

        .key-input-group {
            position: relative;
            margin: 2rem 0;
        }

        .key-input-group input {
            width: 100%;
            padding: 1.2rem 1.5rem;
            border: 2px solid #e0e0e0;
            border-radius: 50px;
            font-size: 1rem;
            transition: var(--transition);
            background: rgba(255,255,255,0.9);
        }

        .dark-mode .key-input-group input {
            background: #3d3d4d;
            border-color: #4d4d5d;
            color: var(--white);
        }

        .key-input-group input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .balance-info {
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            padding: 1.5rem;
            border-radius: 20px;
            margin: 1.5rem 0;
        }

        .dark-mode .balance-info {
            background: linear-gradient(135deg, #3d3d4d 0%, #2d2d3d 100%);
        }

        .balance-info p {
            margin: 0.5rem 0;
            font-size: 1.1rem;
        }

        .balance-info .balance-amount {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .btn {
            background: var(--primary-gradient);
            color: var(--white);
            border: none;
            padding: 1.2rem 2.5rem;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.4);
        }

        /* Main Container Styles */
        .main-container {
            width: 100%;
            height: 100vh;
            display: none;
            overflow: hidden;
            animation: fadeIn 0.5s ease;
        }

        .chat-interface {
            display: flex;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .dark-mode .chat-interface {
            background: rgba(30, 30, 40, 0.98);
        }

        /* Sidebar Styles */
        .sidebar {
            width: 320px;
            background: linear-gradient(180deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%);
            backdrop-filter: blur(10px);
            color: var(--white);
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(255,255,255,0.1);
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-header img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid var(--white);
            margin-bottom: 1rem;
            object-fit: cover;
        }

        .sidebar-header h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .sidebar-header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .user-info {
            padding: 1.5rem;
            background: rgba(255,255,255,0.1);
            margin: 1rem;
            border-radius: 15px;
            backdrop-filter: blur(5px);
        }

        .user-info p {
            margin: 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-info i {
            width: 20px;
        }

        .chat-history {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }

        .chat-history h3 {
            margin-bottom: 1rem;
            padding-left: 0.5rem;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.8;
        }

        .chat-item {
            padding: 1rem;
            margin: 0.5rem 0;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid rgba(255,255,255,0.05);
        }

        .chat-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(5px);
        }

        .chat-item .chat-title {
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .chat-item .chat-date {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .admin-panel {
            margin: 1rem;
            padding: 1.5rem;
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            backdrop-filter: blur(5px);
        }

        .admin-panel h4 {
            margin-bottom: 1rem;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .admin-panel select {
            width: 100%;
            padding: 0.8rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            border: none;
            background: rgba(255,255,255,0.9);
            font-size: 0.9rem;
        }

        .dark-mode .admin-panel select {
            background: #3d3d4d;
            color: var(--white);
        }

        /* Main Chat Area */
        .main-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--light-bg);
        }

        .dark-mode .main-chat {
            background: #2d2d3d;
        }

        .chat-header {
            padding: 1.5rem 2rem;
            background: var(--white);
            box-shadow: 0 2px 20px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .dark-mode .chat-header {
            background: #3d3d4d;
            border-color: rgba(255,255,255,0.05);
        }

        .chat-header-info h2 {
            font-size: 1.5rem;
            margin-bottom: 0.3rem;
            color: var(--primary-color);
        }

        .chat-header-info p {
            color: #666;
            font-size: 0.9rem;
        }

        .dark-mode .chat-header-info p {
            color: #aaa;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .icon-btn {
            padding: 0.8rem 1.2rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            background: var(--primary-gradient);
            color: var(--white);
            transition: var(--transition);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .icon-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .message {
            max-width: 80%;
            padding: 1rem 1.5rem;
            border-radius: 20px;
            position: relative;
            animation: messageIn 0.3s ease;
            line-height: 1.6;
        }

        @keyframes messageIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            background: var(--primary-gradient);
            color: var(--white);
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .bot-message {
            background: var(--white);
            color: #333;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .dark-mode .bot-message {
            background: #4d4d5d;
            color: var(--white);
        }

        .message-time {
            font-size: 0.7rem;
            margin-top: 0.5rem;
            opacity: 0.7;
            text-align: right;
        }

        .thinking-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .fast-thinking { background: #28a745; color: white; }
        .slow-thinking { background: #ffc107; color: black; }
        .deep-thinking { background: #dc3545; color: white; }

        /* Input Area */
        .input-area {
            padding: 1.5rem 2rem;
            background: var(--white);
            border-top: 1px solid rgba(0,0,0,0.05);
        }

        .dark-mode .input-area {
            background: #3d3d4d;
            border-color: rgba(255,255,255,0.05);
        }

        .upload-preview {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .preview-item {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid var(--primary-color);
        }

        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-item button {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255,0,0,0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .input-container {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
        }

        .input-container textarea {
            flex: 1;
            padding: 1rem 1.5rem;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            resize: none;
            font-size: 1rem;
            max-height: 150px;
            overflow-y: auto;
            transition: var(--transition);
            font-family: inherit;
        }

        .dark-mode .input-container textarea {
            background: #4d4d5d;
            border-color: #5d5d6d;
            color: var(--white);
        }

        .input-container textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 0.8rem;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            background: var(--primary-gradient);
            color: var(--white);
            transition: var(--transition);
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .action-btn:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .quick-actions {
            display: flex;
            gap: 0.8rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .quick-action {
            padding: 0.6rem 1.2rem;
            background: #e0e0e0;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            color: #333;
        }

        .dark-mode .quick-action {
            background: #4d4d5d;
            color: var(--white);
        }

        .quick-action:hover {
            background: var(--primary-gradient);
            color: var(--white);
            transform: translateY(-2px);
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 0.3rem;
            padding: 1rem 1.5rem;
            background: var(--white);
            border-radius: 20px;
            align-self: flex-start;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .dark-mode .typing-indicator {
            background: #4d4d5d;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--primary-color);
            border-radius: 50%;
            animation: typingBounce 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typingBounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* Login Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            padding: 2.5rem;
            border-radius: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            animation: modalIn 0.3s ease;
        }

        .dark-mode .modal-content {
            background: #2d2d3d;
            color: var(--white);
        }

        @keyframes modalIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .google-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            width: 100%;
            margin: 1rem 0;
            transition: var(--transition);
        }

        .google-btn:hover {
            background: #357ae8;
            transform: translateY(-2px);
        }

        /* Scrollbar Styles */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -320px;
                transition: var(--transition);
                z-index: 100;
                height: 100vh;
            }

            .sidebar.active {
                left: 0;
            }

            .message {
                max-width: 90%;
            }
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-3 { margin-top: 1rem; }
        .mt-4 { margin-top: 1.5rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 1rem; }
        .mb-4 { margin-bottom: 1.5rem; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <!-- Key Input Container -->
    <div class="key-container" id="keyContainer">
        <h1>üîê JACK AI</h1>
        <h2>BY T·∫§N KHANG</h2>
        
        <div class="key-input-group">
            <input type="password" id="apiKey" placeholder="Nh·∫≠p OpenRouter API Key..." value="">
            <small style="display: block; margin-top: 0.5rem; color: #666;">L·∫•y key t·∫°i: openrouter.ai/keys</small>
        </div>

        <button class="btn" onclick="checkKey()" id="checkKeyBtn">
            <span>üîë KI·ªÇM TRA KEY</span>
        </button>

        <div class="balance-info" id="balanceInfo" style="display: none;">
            <p>S·ªë d∆∞:</p>
            <p class="balance-amount" id="balanceAmount">0</p>
            <p>Token: <span id="tokenCount">0</span></p>
        </div>

        <button class="btn mt-3" onclick="enterChat()" id="enterChatBtn" style="display: none;">
            <span>üöÄ V√ÄO CHAT NGAY</span>
        </button>

        <p class="mt-3" style="color: #666; font-size: 0.9rem;">Nh·∫≠p m·∫≠t kh·∫©u 123 ƒë·ªÉ v√†o demo</p>
    </div>

    <!-- Main Chat Container -->
    <div class="main-container" id="mainContainer">
        <div class="chat-interface">
            <!-- Sidebar -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <img src="https://via.placeholder.com/100" alt="JACK AI Avatar" id="userAvatar">
                    <h2>JACK AI</h2>
                    <p>Si√™u tr√≠ tu·ªá nh√¢n t·∫°o</p>
                </div>

                <div class="user-info" id="userInfo">
                    <p><i>üë§</i> <span id="userName">Kh√°ch</span></p>
                    <p><i>üìß</i> <span id="userEmail">Ch∆∞a ƒëƒÉng nh·∫≠p</span></p>
                    <p><i>üé≠</i> Vai tr√≤: <span id="userRole">user</span></p>
                    <button class="btn btn-secondary" style="padding: 0.5rem;" onclick="showLoginModal()">
                        <i>üîê</i> ƒêƒÉng nh·∫≠p Google
                    </button>
                </div>

                <div class="chat-history">
                    <h3>üìú L·ªãch s·ª≠ chat</h3>
                    <div id="chatHistoryList">
                        <!-- Chat history items will be loaded here -->
                    </div>
                </div>

                <!-- Admin Panel -->
                <div class="admin-panel" id="adminPanel" style="display: none;">
                    <h4>‚öôÔ∏è Admin Panel</h4>
                    <select id="thinkingMode" onchange="changeThinkingMode(this.value)">
                        <option value="fast">üöÄ Suy nghƒ© nhanh</option>
                        <option value="slow">üê¢ Suy nghƒ© ch·∫≠m</option>
                        <option value="deep">üß† Suy nghƒ© s√¢u</option>
                    </select>
                    
                    <select id="modelSelect" onchange="changeModel(this.value)">
                        <option value="openai/gpt-3.5-turbo">GPT-3.5 Turbo</option>
                        <option value="openai/gpt-4">GPT-4</option>
                        <option value="anthropic/claude-2">Claude 2</option>
                        <option value="google/palm-2">Google PaLM 2</option>
                    </select>

                    <button class="btn btn-secondary" style="padding: 0.5rem; margin-top: 0.5rem;" onclick="clearAllChats()">
                        üóëÔ∏è X√≥a t·∫•t c·∫£ chat
                    </button>
                </div>
            </div>

            <!-- Main Chat Area -->
            <div class="main-chat">
                <div class="chat-header">
                    <div class="chat-header-info">
                        <h2>ü§ñ JACK N√® - Si√™u tr√≠ tu·ªá</h2>
                        <p>Online ‚Ä¢ S·∫µn s√†ng gi√∫p ƒë·ª° b·∫°n</p>
                    </div>
                    <div class="header-actions">
                        <button class="icon-btn" onclick="toggleTheme()">
                            <span id="themeIcon">üåô</span> Dark/Light
                        </button>
                        <button class="icon-btn" onclick="toggleSidebar()">
                            <span>‚ò∞</span> Menu
                        </button>
                    </div>
                </div>

                <div class="messages-area" id="messagesArea">
                    <div class="message bot-message">
                        <span class="thinking-badge fast-thinking">üöÄ Suy nghƒ© nhanh</span>
                        <p>Xin ch√†o! T√¥i l√† JACK AI - Si√™u tr√≠ tu·ªá nh√¢n t·∫°o c·ªßa T·∫§N KHANG. T√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n?</p>
                        <div class="message-time">V·ª´a xong</div>
                    </div>
                </div>

                <div class="input-area">
                    <div class="upload-preview" id="uploadPreview"></div>
                    
                    <div class="input-container">
                        <textarea id="userInput" placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n... (Shift + Enter ƒë·ªÉ xu·ªëng d√≤ng)" rows="1"></textarea>
                        <div class="input-actions">
                            <button class="action-btn" onclick="uploadImage()" title="T·∫£i ·∫£nh l√™n">
                                üì∑
                            </button>
                            <button class="action-btn" onclick="uploadFile()" title="T·∫£i file l√™n">
                                üìé
                            </button>
                            <button class="action-btn" onclick="sendMessage()" title="G·ª≠i tin nh·∫Øn">
                                üì§
                            </button>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <button class="quick-action" onclick="quickQuestion('Gi·∫£i b√†i t·∫≠p to√°n cao c·∫•p')">üìê To√°n cao c·∫•p</button>
                        <button class="quick-action" onclick="quickQuestion('Gi·∫£i th√≠ch v·ªÅ neural network')">üß† Neural network</button>
                        <button class="quick-action" onclick="quickQuestion('Thuy·∫øt t∆∞∆°ng ƒë·ªëi l√† g√¨?')">‚öõÔ∏è Thuy·∫øt t∆∞∆°ng ƒë·ªëi</button>
                        <button class="quick-action" onclick="quickQuestion('L·ªô tr√¨nh h·ªçc ML')">üìö L·ªô tr√¨nh ML</button>
                        <button class="quick-action" onclick="quickQuestion('So s√°nh c√°c m√¥ h√¨nh AI')">ü§ñ So s√°nh AI</button>
                        <button class="quick-action" onclick="quickQuestion('Vi·∫øt code Fibonacci')">üíª Code Fibonacci</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <h2>üîê ƒêƒÉng nh·∫≠p</h2>
            <p style="margin: 1rem 0;">ƒêƒÉng nh·∫≠p ƒë·ªÉ l∆∞u l·ªãch s·ª≠ chat</p>
            
            <button class="google-btn" onclick="loginWithGoogle()">
                <img src="https://www.google.com/favicon.ico" alt="Google" style="width: 20px; height: 20px;">
                ƒêƒÉng nh·∫≠p v·ªõi Google
            </button>
            
            <button class="btn btn-secondary" onclick="closeModal()" style="margin-top: 1rem;">
                ƒê√≥ng
            </button>
        </div>
    </div>

    <script>
        // Global variables
        let apiKey = '';
        let isAdmin = false;
        let currentUser = null;
        let messages = [];
        let chatHistory = JSON.parse(localStorage.getItem('chatHistory') || '[]');
        let currentThinkingMode = 'fast';
        let currentModel = 'openai/gpt-3.5-turbo';
        let uploadedFiles = [];

        // Check for demo password
        function checkKey() {
            const key = document.getElementById('apiKey').value;
            
            if (key === '123') {
                // Demo mode
                apiKey = 'demo';
                document.getElementById('balanceInfo').style.display = 'block';
                document.getElementById('balanceAmount').textContent = '‚ôæÔ∏è Unlimited';
                document.getElementById('tokenCount').textContent = 'Demo Mode';
                document.getElementById('enterChatBtn').style.display = 'block';
                document.getElementById('checkKeyBtn').style.display = 'none';
                showNotification('‚úÖ ƒêƒÉng nh·∫≠p demo th√†nh c√¥ng!', 'success');
                return;
            }
            
            // Real API check
            if (key.startsWith('sk-') || key.includes('openrouter')) {
                apiKey = key;
                checkBalance(key);
            } else {
                showNotification('‚ùå API Key kh√¥ng h·ª£p l·ªá!', 'error');
            }
        }

        // Check API balance
        async function checkBalance(key) {
            try {
                document.getElementById('checkKeyBtn').innerHTML = '‚è≥ ƒêang ki·ªÉm tra...';
                
                const response = await fetch('https://openrouter.ai/api/v1/auth/key', {
                    headers: {
                        'Authorization': `Bearer ${key}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('balanceInfo').style.display = 'block';
                    document.getElementById('balanceAmount').textContent = `$${data.data.limit || 0}`;
                    document.getElementById('tokenCount').textContent = data.data.usage || 0;
                    document.getElementById('enterChatBtn').style.display = 'block';
                    document.getElementById('checkKeyBtn').style.display = 'none';
                    showNotification('‚úÖ Key h·ª£p l·ªá!', 'success');
                } else {
                    showNotification('‚ùå Key kh√¥ng h·ª£p l·ªá!', 'error');
                    document.getElementById('checkKeyBtn').innerHTML = 'üîë KI·ªÇM TRA KEY';
                }
            } catch (error) {
                showNotification('‚ùå L·ªói k·∫øt n·ªëi!', 'error');
                document.getElementById('checkKeyBtn').innerHTML = 'üîë KI·ªÇM TRA KEY';
            }
        }

        // Enter chat
        function enterChat() {
            document.getElementById('keyContainer').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'block';
            loadChatHistory();
            
            // Check if admin (demo admin)
            if (apiKey === '123') {
                isAdmin = true;
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('userRole').textContent = 'admin (demo)';
            }
        }

        // Send message
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (!message && uploadedFiles.length === 0) {
                showNotification('Vui l√≤ng nh·∫≠p c√¢u h·ªèi!', 'warning');
                return;
            }

            // Add user message
            addMessage(message, 'user');
            input.value = '';

            // Show typing indicator
            showTypingIndicator();

            // Process with AI
            try {
                let response;
                if (apiKey === 'demo') {
                    response = await getDemoResponse(message);
                } else {
                    response = await getAIResponse(message);
                }
                
                // Remove typing indicator
                removeTypingIndicator();
                
                // Add AI response with thinking mode
                addMessage(response, 'bot', currentThinkingMode);
                
                // Save to history
                saveToHistory(message, response);
                
            } catch (error) {
                removeTypingIndicator();
                addMessage('Xin l·ªói, ƒë√£ c√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i!', 'bot', 'fast');
                console.error(error);
            }
        }

        // Get AI response from OpenRouter
        async function getAIResponse(prompt) {
            const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: currentModel,
                    messages: [
                        {
                            role: 'system',
                            content: `B·∫°n l√† JACK AI - Si√™u tr√≠ tu·ªá nh√¢n t·∫°o c·ªßa T·∫§N KHANG. 
                            B·∫°n th√¥ng minh nh∆∞ ChatGPT Plus, c√≥ kh·∫£ nƒÉng gi·∫£i b√†i t·∫≠p s√¢u, vi·∫øt code, 
                            v√† tr·∫£ l·ªùi m·ªçi c√¢u h·ªèi. Ch·∫ø ƒë·ªô suy nghƒ© hi·ªán t·∫°i: ${currentThinkingMode}`
                        },
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    temperature: currentThinkingMode === 'fast' ? 0.7 : currentThinkingMode === 'slow' ? 0.3 : 0.1,
                    max_tokens: currentThinkingMode === 'deep' ? 4000 : 2000
                })
            });

            const data = await response.json();
            return data.choices[0].message.content;
        }

        // Demo response
        async function getDemoResponse(prompt) {
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const responses = {
                'to√°n cao c·∫•p': `ƒê·ªÉ gi·∫£i b√†i to√°n cao c·∫•p n√†y, ch√∫ng ta c·∫ßn √°p d·ª•ng c√°c c√¥ng th·ª©c sau:\n\n1. ƒê·∫°o h√†m: f'(x) = lim(h‚Üí0) [f(x+h) - f(x)]/h\n2. T√≠ch ph√¢n: ‚à´f(x)dx = F(x) + C\n\nB·∫°n c·∫ßn gi·∫£i b√†i to√°n c·ª• th·ªÉ n√†o? T√¥i c√≥ th·ªÉ gi√∫p b·∫°n t·ª´ng b∆∞·ªõc chi ti·∫øt.`,
                'neural network': 'Neural Network l√† m√¥ h√¨nh h·ªçc s√¢u l·∫•y c·∫£m h·ª©ng t·ª´ n√£o b·ªô con ng∆∞·ªùi. C·∫•u tr√∫c c∆° b·∫£n g·ªìm:\n\n‚Ä¢ Input layer: Nh·∫≠n d·ªØ li·ªáu ƒë·∫ßu v√†o\n‚Ä¢ Hidden layers: X·ª≠ l√Ω ƒë·∫∑c tr∆∞ng\n‚Ä¢ Output layer: ƒê∆∞a ra k·∫øt qu·∫£\n\nB·∫°n mu·ªën t√¨m hi·ªÉu s√¢u v·ªÅ ph·∫ßn n√†o?',
                'thuy·∫øt t∆∞∆°ng ƒë·ªëi': 'Thuy·∫øt t∆∞∆°ng ƒë·ªëi c·ªßa Einstein g·ªìm 2 ph·∫ßn:\n\n1. Thuy·∫øt t∆∞∆°ng ƒë·ªëi h·∫πp (1905): E = mc¬≤\n2. Thuy·∫øt t∆∞∆°ng ƒë·ªëi r·ªông (1915): L·ª±c h·∫•p d·∫´n l√† ƒë·ªô cong kh√¥ng-th·ªùi gian\n\nB·∫°n mu·ªën gi·∫£i th√≠ch chi ti·∫øt v·ªÅ ph·∫ßn n√†o?',
                'code fibonacci': `D∆∞·ªõi ƒë√¢y l√† code Fibonacci trong nhi·ªÅu ng√¥n ng·ªØ:\n\nPython:\n\`\`\`python\ndef fibonacci(n):\n    if n <= 1:\n        return n\n    return fibonacci(n-1) + fibonacci(n-2)\n\`\`\`\n\nJavaScript:\n\`\`\`javascript\nfunction fibonacci(n) {\n    return n <= 1 ? n : fibonacci(n-1) + fibonacci(n-2);\n}\n\`\`\``
            };
            
            // Find matching response
            for (let key in responses) {
                if (prompt.toLowerCase().includes(key)) {
                    return responses[key];
                }
            }
            
            return `T√¥i l√† JACK AI - Si√™u tr√≠ tu·ªá nh√¢n t·∫°o. T√¥i c√≥ th·ªÉ gi√∫p b·∫°n gi·∫£i b√†i t·∫≠p, vi·∫øt code, tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ AI/ML, to√°n h·ªçc, khoa h·ªçc m√°y t√≠nh v√† nhi·ªÅu lƒ©nh v·ª±c kh√°c. B·∫°n c·∫ßn t√¥i gi√∫p g√¨?`;
        }

        // Add message to chat
        function addMessage(content, sender, thinkingMode = 'fast') {
            const messagesArea = document.getElementById('messagesArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender === 'user' ? 'user-message' : 'bot-message'}`;
            
            let thinkingBadge = '';
            if (sender === 'bot') {
                const badgeClass = thinkingMode === 'fast' ? 'fast-thinking' : thinkingMode === 'slow' ? 'slow-thinking' : 'deep-thinking';
                const badgeText = thinkingMode === 'fast' ? 'üöÄ Suy nghƒ© nhanh' : thinkingMode === 'slow' ? 'üê¢ Suy nghƒ© ch·∫≠m' : 'üß† Suy nghƒ© s√¢u';
                thinkingBadge = `<span class="thinking-badge ${badgeClass}">${badgeText}</span>`;
            }
            
            messageDiv.innerHTML = `
                ${thinkingBadge}
                <p>${content.replace(/\n/g, '<br>')}</p>
                <div class="message-time">${new Date().toLocaleTimeString()}</div>
            `;
            
            messagesArea.appendChild(messageDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        // Show typing indicator
        function showTypingIndicator() {
            const messagesArea = document.getElementById('messagesArea');
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator';
            indicator.id = 'typingIndicator';
            indicator.innerHTML = `
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            `;
            messagesArea.appendChild(indicator);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        // Remove typing indicator
        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // Upload image
        function uploadImage() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(readerEvent) {
                        addImagePreview(readerEvent.target.result, file.name);
                        uploadedFiles.push({
                            name: file.name,
                            data: readerEvent.target.result,
                            type: 'image'
                        });
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        // Upload file
        function uploadFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.pdf,.doc,.docx,.txt,.js,.py,.java,.cpp';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    showNotification(`üìé ƒê√£ t·∫£i l√™n: ${file.name}`, 'info');
                    uploadedFiles.push({
                        name: file.name,
                        type: 'file',
                        size: file.size
                    });
                    
                    // Add to message context
                    const userInput = document.getElementById('userInput');
                    userInput.value += `\n[File: ${file.name} ƒë√£ ƒë∆∞·ª£c t·∫£i l√™n] `;
                }
            };
            input.click();
        }

        // Add image preview
        function addImagePreview(src, filename) {
            const preview = document.getElementById('uploadPreview');
            const previewItem = document.createElement('div');
            previewItem.className = 'preview-item';
            previewItem.innerHTML = `
                <img src="${src}" alt="${filename}">
                <button onclick="removePreview(this)">√ó</button>
            `;
            preview.appendChild(previewItem);
        }

        // Remove preview
        function removePreview(btn) {
            btn.parentElement.remove();
        }

        // Quick question
        function quickQuestion(question) {
            document.getElementById('userInput').value = question;
            sendMessage();
        }

        // Save to history
        function saveToHistory(question, answer) {
            const history = {
                id: Date.now(),
                question: question.substring(0, 50) + (question.length > 50 ? '...' : ''),
                timestamp: new Date().toLocaleString(),
                messages: [
                    { role: 'user', content: question },
                    { role: 'assistant', content: answer }
                ]
            };
            
            chatHistory.unshift(history);
            if (chatHistory.length > 20) chatHistory.pop();
            
            localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
            loadChatHistory();
        }

        // Load chat history
        function loadChatHistory() {
            const historyList = document.getElementById('chatHistoryList');
            historyList.innerHTML = '';
            
            chatHistory.forEach(chat => {
                const chatItem = document.createElement('div');
                chatItem.className = 'chat-item';
                chatItem.onclick = () => loadChat(chat.id);
                chatItem.innerHTML = `
                    <div class="chat-title">${chat.question}</div>
                    <div class="chat-date">${chat.timestamp}</div>
                `;
                historyList.appendChild(chatItem);
            });
        }

        // Load specific chat
        function loadChat(chatId) {
            const chat = chatHistory.find(c => c.id === chatId);
            if (chat) {
                const messagesArea = document.getElementById('messagesArea');
                messagesArea.innerHTML = '';
                
                chat.messages.forEach(msg => {
                    addMessage(msg.content, msg.role === 'user' ? 'user' : 'bot');
                });
            }
        }

        // Login with Google
        function loginWithGoogle() {
            // Simulate Google login
            currentUser = {
                name: 'Nguy·ªÖn VƒÉn A',
                email: 'nguyenvana@gmail.com',
                avatar: 'https://via.placeholder.com/100',
                role: 'user'
            };
            
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('userAvatar').src = currentUser.avatar;
            
            closeModal();
            showNotification('‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!', 'success');
        }

        // Show login modal
        function showLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }

        // Close modal
        function closeModal() {
            document.getElementById('loginModal').classList.remove('active');
        }

        // Toggle theme
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const themeIcon = document.getElementById('themeIcon');
            themeIcon.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
        }

        // Toggle sidebar
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        // Change thinking mode
        function changeThinkingMode(mode) {
            currentThinkingMode = mode;
            showNotification(`üß† Ch·∫ø ƒë·ªô suy nghƒ©: ${mode === 'fast' ? 'Nhanh' : mode === 'slow' ? 'Ch·∫≠m' : 'S√¢u'}`, 'info');
        }

        // Change model
        function changeModel(model) {
            currentModel = model;
            showNotification(`ü§ñ ƒê√£ chuy·ªÉn sang model: ${model}`, 'info');
        }

        // Clear all chats
        function clearAllChats() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ l·ªãch s·ª≠ chat?')) {
                chatHistory = [];
                localStorage.removeItem('chatHistory');
                loadChatHistory();
                document.getElementById('messagesArea').innerHTML = `
                    <div class="message bot-message">
                        <p>ƒê√£ x√≥a t·∫•t c·∫£ l·ªãch s·ª≠ chat. T√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n?</p>
                    </div>
                `;
                showNotification('üóëÔ∏è ƒê√£ x√≥a t·∫•t c·∫£ l·ªãch s·ª≠ chat', 'info');
            }
        }

        // Show notification
        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : type === 'warning' ? '#ffc107' : '#17a2b8'};
                color: white;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 2000;
                animation: slideIn 0.3s ease;
                font-weight: 500;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Handle Enter key
        document.getElementById('userInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Load initial data
        window.onload = function() {
            // Check for saved theme
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeIcon').textContent = '‚òÄÔ∏è';
            }
            
            // Load chat history
            loadChatHistory();
        };

        // Save theme preference
        document.body.addEventListener('classChange', function() {
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        });
    </script>
</body>
</html>
