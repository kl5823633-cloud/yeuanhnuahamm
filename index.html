<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JACK AI - BY T·∫§N KHANG</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #7c3aed;
            --dark: #0f172a;
            --darker: #020617;
            --light: #f8fafc;
            --gray: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border: #e2e8f0;
        }

        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
            position: relative;
        }

        body.dark-mode {
            background: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
        }

        /* Weather Bar */
        .weather-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 0.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .weather-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .activate-windows {
            color: #ffd700;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* Key Container */
        .key-container {
            background: white;
            padding: 2rem;
            border-radius: 30px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
            width: 90%;
            max-width: 400px;
            text-align: center;
            animation: slideUp 0.5s ease;
            margin-top: 60px;
        }

        body.dark-mode .key-container {
            background: #1e293b;
            color: white;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .avatar-large {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            border: 4px solid white;
            overflow: hidden;
        }

        .avatar-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .key-container h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.2rem;
        }

        .key-container h2 {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }

        .input-group {
            margin: 1rem 0;
        }

        .input-group input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 50px;
            font-size: 0.95rem;
            transition: all 0.3s;
        }

        body.dark-mode .input-group input {
            background: #334155;
            border-color: #475569;
            color: white;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37,99,235,0.2);
        }

        .btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            box-shadow: 0 10px 20px -5px rgba(37,99,235,0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 30px -5px rgba(37,99,235,0.6);
        }

        .demo-text {
            margin: 1rem 0;
            padding: 0.8rem;
            background: #f1f5f9;
            border-radius: 20px;
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Main Container */
        .main-container {
            width: 100%;
            height: 100vh;
            display: none;
            background: var(--light);
            padding-top: 60px;
        }

        body.dark-mode .main-container {
            background: var(--dark);
        }

        .cover-image {
            width: 100%;
            height: 150px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            position: relative;
        }

        .change-cover-btn {
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 30px;
            cursor: pointer;
            font-size: 0.8rem;
            display: none;
            align-items: center;
            gap: 0.5rem;
        }

        .change-cover-btn.visible {
            display: flex;
        }

        .chat-interface {
            display: flex;
            height: calc(100% - 150px);
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #1e293b, #0f172a);
            color: white;
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(255,255,255,0.1);
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 1.5rem 1rem;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .avatar-container {
            position: relative;
            width: 70px;
            height: 70px;
            margin: 0 auto 0.8rem;
        }

        .sidebar-avatar {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            border: 3px solid white;
            overflow: hidden;
        }

        .sidebar-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .change-avatar-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 0.2rem;
            border-radius: 0 0 35px 35px;
            font-size: 0.6rem;
            cursor: pointer;
            display: none;
        }

        .change-avatar-overlay.visible {
            display: block;
        }

        .user-info {
            padding: 1rem;
            background: rgba(255,255,255,0.1);
            margin: 1rem;
            border-radius: 15px;
        }

        .user-info-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.5rem 0;
            font-size: 0.85rem;
        }

        .social-login {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.8rem;
            justify-content: center;
        }

        .social-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.2rem;
        }

        .social-btn:hover {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            transform: translateY(-2px);
        }

        .chat-history {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }

        .chat-history h4 {
            color: #94a3b8;
            font-size: 0.8rem;
            margin-bottom: 0.8rem;
            text-transform: uppercase;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .new-chat-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.7rem;
            cursor: pointer;
            display: none;
            align-items: center;
            gap: 0.3rem;
        }

        .new-chat-btn.visible {
            display: flex;
        }

        .history-item {
            padding: 0.8rem;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .history-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .history-item .time {
            font-size: 0.65rem;
            color: #94a3b8;
            margin-top: 0.2rem;
        }

        .admin-chat-btn {
            margin: 1rem;
            padding: 0.8rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        /* Main Chat */
        .main-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
        }

        body.dark-mode .main-chat {
            background: #1e293b;
        }

        .chat-header {
            padding: 1rem 1.5rem;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .header-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            overflow: hidden;
        }

        .header-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .header-text h2 {
            font-size: 1.2rem;
            color: var(--primary);
        }

        .header-text p {
            font-size: 0.8rem;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .online-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            display: inline-block;
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
        }

        .header-btn {
            padding: 0.4rem 1rem;
            border: none;
            border-radius: 30px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            cursor: pointer;
            font-size: 0.8rem;
        }

        /* Messages Area */
        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 80%;
            padding: 0.8rem 1.2rem;
            border-radius: 15px;
            animation: messageIn 0.3s ease;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        @keyframes messageIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .bot-message {
            background: #f1f5f9;
            color: var(--dark);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }

        body.dark-mode .bot-message {
            background: #334155;
            color: white;
        }

        .thinking-badge {
            display: inline-block;
            padding: 0.2rem 0.8rem;
            border-radius: 30px;
            font-size: 0.65rem;
            margin-bottom: 0.3rem;
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .message-time {
            font-size: 0.65rem;
            margin-top: 0.3rem;
            opacity: 0.7;
            text-align: right;
        }

        /* Input Area */
        .input-area {
            padding: 1rem 1.5rem;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--border);
        }

        .thinking-modes {
            display: flex;
            gap: 0.3rem;
            margin-bottom: 0.8rem;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 0.3rem 1rem;
            border: 2px solid var(--border);
            border-radius: 30px;
            background: white;
            color: var(--gray);
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
        }

        body.dark-mode .mode-btn {
            background: #1e293b;
            border-color: #475569;
            color: #94a3b8;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-color: transparent;
            color: white;
        }

        .input-container {
            display: flex;
            gap: 0.8rem;
            align-items: flex-end;
        }

        .input-container textarea {
            flex: 1;
            padding: 0.8rem 1.2rem;
            border: 2px solid var(--border);
            border-radius: 30px;
            resize: none;
            font-size: 0.9rem;
            max-height: 100px;
            background: white;
        }

        body.dark-mode .input-container textarea {
            background: #1e293b;
            border-color: #475569;
            color: white;
        }

        .input-container textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .input-actions {
            display: flex;
            gap: 0.3rem;
        }

        .action-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            cursor: pointer;
            font-size: 1.1rem;
        }

        .upload-preview {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.8rem;
            flex-wrap: wrap;
        }

        .preview-item {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            border: 2px solid var(--primary);
        }

        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-item button {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: none;
            background: var(--danger);
            color: white;
            cursor: pointer;
            font-size: 10px;
        }

        .quick-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.8rem;
            flex-wrap: wrap;
        }

        .quick-action {
            padding: 0.3rem 1rem;
            border: none;
            border-radius: 30px;
            background: #f1f5f9;
            color: var(--gray);
            cursor: pointer;
            font-size: 0.8rem;
        }

        body.dark-mode .quick-action {
            background: #334155;
            color: #e2e8f0;
        }

        .quick-action:hover {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 25px;
            max-width: 350px;
            width: 90%;
        }

        body.dark-mode .modal-content {
            background: #1e293b;
            color: white;
        }

        .admin-messages {
            max-height: 250px;
            overflow-y: auto;
            margin: 1rem 0;
            padding: 0.8rem;
            background: #f1f5f9;
            border-radius: 12px;
        }

        .modal-input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            margin: 0.8rem 0;
        }

        /* Bottom Bar */
        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 0.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 0.3rem;
            padding: 0.8rem 1.2rem;
            background: #f1f5f9;
            border-radius: 20px;
            align-self: flex-start;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: var(--primary);
            border-radius: 50%;
            animation: typingBounce 1.4s infinite;
        }

        @keyframes typingBounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                z-index: 100;
                height: 100%;
                transition: left 0.3s ease;
            }

            .sidebar.active {
                left: 0;
            }

            .message {
                max-width: 90%;
            }
        }
    </style>
</head>
<body>
    <!-- Weather Bar -->
    <div class="weather-bar">
        <div class="weather-info">
            <span>üå°Ô∏è</span>
            <span>32¬∞C N·∫Øng r·∫£i r√°c</span>
        </div>
        <div class="activate-windows">
            ‚öôÔ∏è Activate Windows - Go to Settings to activate Windows
        </div>
    </div>

    <!-- Key Container -->
    <div class="key-container" id="keyContainer">
        <div class="avatar-large" id="mainAvatar">
            <img src="https://via.placeholder.com/100/2563eb/ffffff?text=J" alt="JACK AI" id="mainAvatarImg">
        </div>
        <h1>JACK AI</h1>
        <h2>BY T·∫§N KHANG</h2>

        <div class="input-group">
            <input type="password" id="apiKey" placeholder="Nh·∫≠p OpenRouter API Key...">
        </div>

        <button class="btn" onclick="checkApiKey()" id="checkKeyBtn">
            <span>üîç KI·ªÇM TRA KEY</span>
        </button>

        <div class="demo-text">
            <p>Nh·∫≠p m·∫≠t kh·∫©u 123 ƒë·ªÉ v√†o demo</p>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container" id="mainContainer">
        <!-- Cover Image -->
        <div class="cover-image" id="coverImage">
            <button class="change-cover-btn" id="changeCoverBtn">
                <span>üì∑</span> ƒê·ªïi ·∫£nh b√¨a
            </button>
        </div>

        <div class="chat-interface">
            <!-- Sidebar -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <div class="avatar-container">
                        <div class="sidebar-avatar" id="sidebarAvatar">
                            <img src="https://via.placeholder.com/70/2563eb/ffffff?text=J" alt="JACK AI" id="sidebarAvatarImg">
                        </div>
                        <div class="change-avatar-overlay" id="changeAvatarBtn">
                            <span>üì∑</span> ƒê·ªïi avatar
                        </div>
                    </div>
                    <h3>JACK AI</h3>
                    <p>Si√™u tr√≠ tu·ªá nh√¢n t·∫°o</p>
                </div>

                <div class="user-info" id="userInfo">
                    <div class="user-info-item">
                        <span>üë§</span>
                        <span id="userName">Kh√°ch</span>
                    </div>
                    <div class="user-info-item">
                        <span>üìß</span>
                        <span id="userEmail">Ch∆∞a ƒëƒÉng nh·∫≠p</span>
                    </div>
                    <div class="user-info-item">
                        <span>üé≠</span>
                        <span id="userRole">Vai tr√≤: user</span>
                    </div>
                    
                    <div class="social-login" id="socialLogin">
                        <button class="social-btn" onclick="loginWithGoogle()">G</button>
                        <button class="social-btn" onclick="loginWithFacebook()">f</button>
                        <button class="social-btn" onclick="loginWithTwitter()">ùïè</button>
                    </div>
                </div>

                <div class="chat-history">
                    <div class="history-header">
                        <h4>üìú L·ªäCH S·ª¨ CHAT</h4>
                        <button class="new-chat-btn" id="newChatBtn" onclick="startNewChat()">
                            <span>‚ûï</span> New chat
                        </button>
                    </div>
                    <div id="chatHistoryList"></div>
                </div>

                <button class="admin-chat-btn" onclick="openAdminChat()">
                    <span>üí¨</span> NH·∫ÆN TIN V·ªöI ADMIN
                </button>
            </div>

            <!-- Main Chat Area -->
            <div class="main-chat">
                <div class="chat-header">
                    <div class="header-info">
                        <div class="header-avatar" id="headerAvatar">
                            <img src="https://via.placeholder.com/45/2563eb/ffffff?text=J" alt="JACK" id="headerAvatarImg">
                        </div>
                        <div class="header-text">
                            <h2>JACK N√® - Si√™u tr√≠ tu·ªá</h2>
                            <p>
                                <span class="online-dot"></span>
                                Online ‚Ä¢ S·∫µn s√†ng gi√∫p ƒë·ª° b·∫°n
                            </p>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button class="header-btn" onclick="toggleSidebar()">‚ò∞ Menu</button>
                        <button class="header-btn" onclick="toggleTheme()" id="themeToggle">üåô Dark/Light</button>
                    </div>
                </div>

                <div class="messages-area" id="messagesArea">
                    <!-- Messages will be displayed here -->
                </div>

                <div class="input-area">
                    <!-- Thinking Modes -->
                    <div class="thinking-modes">
                        <button class="mode-btn active" onclick="setThinkingMode('fast')" id="fastMode">‚ö° Suy nghƒ© nhanh</button>
                        <button class="mode-btn" onclick="setThinkingMode('slow')" id="slowMode">üê¢ Suy nghƒ© ch·∫≠m</button>
                        <button class="mode-btn" onclick="setThinkingMode('deep')" id="deepMode">üß† Th√¥ng minh</button>
                    </div>

                    <!-- Upload Preview -->
                    <div class="upload-preview" id="uploadPreview"></div>

                    <!-- Input Container -->
                    <div class="input-container">
                        <textarea id="userInput" placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n... (Shift + Enter ƒë·ªÉ xu·ªëng d√≤ng)" rows="1"></textarea>
                        <div class="input-actions">
                            <button class="action-btn" onclick="uploadImage()" title="T·∫£i ·∫£nh l√™n">üì∑</button>
                            <button class="action-btn" onclick="uploadFile()" title="T·∫£i file l√™n">üìé</button>
                            <button class="action-btn" onclick="sendMessage()" title="G·ª≠i tin nh·∫Øn">üì§</button>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <button class="quick-action" onclick="quickQuestion('Gi·∫£i b√†i t·∫≠p to√°n cao c·∫•p')">To√°n cao c·∫•p</button>
                        <button class="quick-action" onclick="quickQuestion('Gi·∫£i th√≠ch neural network')">Neural network</button>
                        <button class="quick-action" onclick="quickQuestion('Thuy·∫øt t∆∞∆°ng ƒë·ªëi l√† g√¨?')">Thuy·∫øt t∆∞∆°ng ƒë·ªëi</button>
                        <button class="quick-action" onclick="quickQuestion('L·ªô tr√¨nh h·ªçc ML')">L·ªô tr√¨nh ML</button>
                        <button class="quick-action" onclick="quickQuestion('So s√°nh c√°c m√¥ h√¨nh AI')">So s√°nh AI</button>
                        <button class="quick-action" onclick="quickQuestion('Vi·∫øt code Fibonacci')">Code Fibonacci</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Chat Modal -->
    <div class="modal" id="adminChatModal">
        <div class="modal-content">
            <h2>üí¨ Chat v·ªõi Admin</h2>
            <div class="admin-messages" id="adminMessages">
                <div class="message bot-message" style="max-width: 100%;">
                    <p>Ch√†o b·∫°n! B·∫°n c·∫ßn h·ªó tr·ª£ g√¨?</p>
                    <div class="message-time">H·ªá th·ªëng</div>
                </div>
            </div>
            <input type="text" id="adminMessageInput" class="modal-input" placeholder="Nh·∫≠p tin nh·∫Øn...">
            <button class="btn" onclick="sendAdminMessage()">G·ª≠i tin nh·∫Øn</button>
            <button class="btn" style="margin-top: 0.5rem; background: #6c757d;" onclick="closeAdminChat()">ƒê√≥ng</button>
        </div>
    </div>

    <!-- File Inputs -->
    <input type="file" id="avatarInput" accept="image/*" style="display: none;">
    <input type="file" id="coverInput" accept="image/*" style="display: none;">

    <!-- Bottom Bar -->
    <div class="bottom-bar">
        <div class="weather-info">
            <span>üå°Ô∏è</span>
            <span>32¬∞C N·∫Øng r·∫£i r√°c</span>
        </div>
        <div class="activate-windows">
            ‚öôÔ∏è Activate Windows - Go to Settings to activate Windows
        </div>
    </div>

    <script>
        // Global variables
        let apiKey = '';
        let isDemo = false;
        let currentUser = null;
        let isAdmin = false;
        let currentThinkingMode = 'fast';
        let chatHistory = [];
        let uploadedFiles = [];
        const ADMIN_EMAIL = 'kl5823633@gmail.com';

        // Avatar storage
        let jackAvatar = localStorage.getItem('jackAvatar') || 'https://via.placeholder.com/100/2563eb/ffffff?text=J';
        let jackCover = localStorage.getItem('jackCover') || '';

        // Initialize on load
        window.onload = function() {
            // Set avatars
            document.getElementById('mainAvatarImg').src = jackAvatar;
            document.getElementById('sidebarAvatarImg').src = jackAvatar;
            document.getElementById('headerAvatarImg').src = jackAvatar;
            
            if (jackCover) {
                document.getElementById('coverImage').style.background = `url('${jackCover}') center/cover`;
            }

            // Load theme
            if (localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeToggle').innerHTML = '‚òÄÔ∏è Dark/Light';
            }

            // Add welcome message
            document.getElementById('messagesArea').innerHTML = `
                <div class="message bot-message">
                    <p>Xin ch√†o! T√¥i l√† JACK AI - Si√™u tr√≠ tu·ªá nh√¢n t·∫°o. T√¥i ƒë√£ s·∫µn s√†ng gi√∫p ƒë·ª° b·∫°n!</p>
                    <div class="message-time">${new Date().toLocaleTimeString()}</div>
                </div>
            `;
        };

        // Check API Key
        function checkApiKey() {
            const key = document.getElementById('apiKey').value.trim();
            
            if (key === '123') {
                // Demo mode
                isDemo = true;
                apiKey = 'demo';
                showNotification('‚úÖ ƒêƒÉng nh·∫≠p demo th√†nh c√¥ng!', 'success');
                enterChat();
                return;
            }
            
            if (key.startsWith('sk-') || key.includes('openrouter') || key.length > 20) {
                // Real API mode
                apiKey = key;
                isDemo = false;
                showNotification('‚úÖ ƒêang k·∫øt n·ªëi v·ªõi OpenRouter API...', 'info');
                enterChat();
            } else {
                showNotification('‚ùå API Key kh√¥ng h·ª£p l·ªá! Vui l√≤ng nh·∫≠p key h·ª£p l·ªá ho·∫∑c "123" ƒë·ªÉ v√†o demo', 'error');
            }
        }

        // Enter chat
        function enterChat() {
            document.getElementById('keyContainer').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'block';
            
            if (isDemo) {
                // Add demo welcome message
                const messagesArea = document.getElementById('messagesArea');
                messagesArea.innerHTML = `
                    <div class="message bot-message">
                        <span class="thinking-badge">üéâ DEMO MODE</span>
                        <p>Xin ch√†o! T√¥i l√† JACK AI - Si√™u tr√≠ tu·ªá nh√¢n t·∫°o do ƒë·ªôi ng≈© c·ªßa T·∫§N KHANG ph√°t tri·ªÉn v√† ho√†n th√†nh. C·∫£m ∆°n b·∫°n ƒë√£ truy c·∫≠p v√†o demo!</p>
                        <div class="message-time">${new Date().toLocaleTimeString()}</div>
                    </div>
                `;
            }
        }

        // Login with Google
        function loginWithGoogle() {
            const email = prompt('Nh·∫≠p email Google c·ªßa b·∫°n:');
            if (email) {
                currentUser = {
                    name: email.split('@')[0],
                    email: email
                };
                
                isAdmin = (email === ADMIN_EMAIL);
                
                // Update UI
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userEmail').textContent = currentUser.email;
                document.getElementById('userRole').textContent = `Vai tr√≤: ${isAdmin ? 'admin' : 'user'}`;
                
                // Hide social login
                document.getElementById('socialLogin').style.display = 'none';
                
                // Show new chat button
                document.getElementById('newChatBtn').classList.add('visible');
                
                // Show admin controls
                if (isAdmin) {
                    document.getElementById('changeAvatarBtn').classList.add('visible');
                    document.getElementById('changeCoverBtn').classList.add('visible');
                }
                
                // Load user's chat history
                loadUserChatHistory();
                
                showNotification(`‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng v·ªõi ${email}`, 'success');
            }
        }

        // Login with Facebook
        function loginWithFacebook() {
            showNotification('üîú T√≠nh nƒÉng ƒëang ph√°t tri·ªÉn', 'info');
            // Gi·∫£ l·∫≠p ƒëƒÉng nh·∫≠p
            setTimeout(() => {
                currentUser = {
                    name: 'Facebook User',
                    email: 'fb_user@facebook.com'
                };
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userEmail').textContent = currentUser.email;
                document.getElementById('socialLogin').style.display = 'none';
                document.getElementById('newChatBtn').classList.add('visible');
                loadUserChatHistory();
                showNotification('‚úÖ ƒêƒÉng nh·∫≠p Facebook th√†nh c√¥ng!', 'success');
            }, 500);
        }

        // Login with Twitter
        function loginWithTwitter() {
            showNotification('üîú T√≠nh nƒÉng ƒëang ph√°t tri·ªÉn', 'info');
            // Gi·∫£ l·∫≠p ƒëƒÉng nh·∫≠p
            setTimeout(() => {
                currentUser = {
                    name: 'Twitter User',
                    email: 'twitter_user@twitter.com'
                };
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userEmail').textContent = currentUser.email;
                document.getElementById('socialLogin').style.display = 'none';
                document.getElementById('newChatBtn').classList.add('visible');
                loadUserChatHistory();
                showNotification('‚úÖ ƒêƒÉng nh·∫≠p Twitter th√†nh c√¥ng!', 'success');
            }, 500);
        }

        // Load user chat history
        function loadUserChatHistory() {
            if (!currentUser) return;
            
            const saved = localStorage.getItem(`chatHistory_${currentUser.email}`);
            chatHistory = saved ? JSON.parse(saved) : [];
            
            const historyList = document.getElementById('chatHistoryList');
            historyList.innerHTML = '';
            
            chatHistory.forEach(chat => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.onclick = () => loadChat(chat.id);
                item.innerHTML = `
                    <div>${chat.question}</div>
                    <div class="time">${chat.time}</div>
                `;
                historyList.appendChild(item);
            });
        }

        // Start new chat
        function startNewChat() {
            document.getElementById('messagesArea').innerHTML = `
                <div class="message bot-message">
                    <p>Xin ch√†o! T√¥i l√† JACK AI - T√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n?</p>
                    <div class="message-time">${new Date().toLocaleTimeString()}</div>
                </div>
            `;
        }

        // Set thinking mode
        function setThinkingMode(mode) {
            currentThinkingMode = mode;
            
            document.getElementById('fastMode').classList.remove('active');
            document.getElementById('slowMode').classList.remove('active');
            document.getElementById('deepMode').classList.remove('active');
            
            if (mode === 'fast') {
                document.getElementById('fastMode').classList.add('active');
            } else if (mode === 'slow') {
                document.getElementById('slowMode').classList.add('active');
            } else {
                document.getElementById('deepMode').classList.add('active');
            }
        }

        // Send message
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (!message && uploadedFiles.length === 0) return;

            // Add user message
            addMessage(message, 'user');
            input.value = '';

            // Show typing indicator
            showTypingIndicator();

            // Get response
            setTimeout(() => {
                removeTypingIndicator();
                
                let response;
                if (isDemo) {
                    response = getDemoResponse(message);
                } else {
                    // Real API call
                    getAIResponse(message).then(res => {
                        addMessage(res, 'bot', currentThinkingMode);
                        if (currentUser) {
                            saveToHistory(message, res);
                        }
                    }).catch(() => {
                        addMessage('Xin l·ªói, c√≥ l·ªói x·∫£y ra khi k·∫øt n·ªëi API. Vui l√≤ng th·ª≠ l·∫°i!', 'bot', currentThinkingMode);
                    });
                    return;
                }
                
                addMessage(response, 'bot', currentThinkingMode);
                if (currentUser) {
                    saveToHistory(message, response);
                }
            }, 1000);
        }

        // Get AI response from OpenRouter
        async function getAIResponse(prompt) {
            try {
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                        'HTTP-Referer': window.location.href,
                        'X-Title': 'JACK AI'
                    },
                    body: JSON.stringify({
                        model: 'openai/gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'system',
                                content: `B·∫°n l√† JACK AI - Si√™u tr√≠ tu·ªá nh√¢n t·∫°o c·ªßa T·∫§N KHANG. B·∫°n th√¥ng minh nh∆∞ ChatGPT Plus. Ch·∫ø ƒë·ªô suy nghƒ© hi·ªán t·∫°i: ${currentThinkingMode}`
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        temperature: currentThinkingMode === 'fast' ? 0.8 : currentThinkingMode === 'slow' ? 0.3 : 0.1,
                        max_tokens: currentThinkingMode === 'deep' ? 2000 : 1000
                    })
                });

                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('API Error:', error);
                return 'Xin l·ªói, c√≥ l·ªói x·∫£y ra khi k·∫øt n·ªëi API. Vui l√≤ng ki·ªÉm tra l·∫°i API key c·ªßa b·∫°n!';
            }
        }

        // Get demo response
        function getDemoResponse(prompt) {
            if (prompt.toLowerCase().includes('to√°n')) {
                return `ƒê·ªÉ gi·∫£i b√†i to√°n n√†y, ch√∫ng ta c·∫ßn:
                
1. X√°c ƒë·ªãnh d·∫°ng b√†i t·∫≠p
2. √Åp d·ª•ng c√¥ng th·ª©c ph√π h·ª£p
3. T√≠nh to√°n c·∫©n th·∫≠n

B·∫°n c√≥ th·ªÉ cho t√¥i b√†i to√°n c·ª• th·ªÉ ƒë·ªÉ gi·∫£i chi ti·∫øt kh√¥ng?`;
            }
            if (prompt.toLowerCase().includes('neural')) {
                return 'Neural Network l√† m√¥ h√¨nh h·ªçc s√¢u l·∫•y c·∫£m h·ª©ng t·ª´ n√£o b·ªô. G·ªìm Input layer, Hidden layers, Output layer. C√°c activation function ph·ªï bi·∫øn: ReLU, Sigmoid, Tanh.';
            }
            if (prompt.toLowerCase().includes('t∆∞∆°ng ƒë·ªëi')) {
                return 'Thuy·∫øt t∆∞∆°ng ƒë·ªëi c·ªßa Einstein:\n‚Ä¢ H·∫πp (1905): E = mc¬≤\n‚Ä¢ R·ªông (1915): Kh√¥ng-th·ªùi gian cong';
            }
            if (prompt.toLowerCase().includes('fibonacci')) {
                return `Code Fibonacci:

Python:
\`\`\`python
def fibonacci(n):
    if n <= 1: return n
    return fibonacci(n-1) + fibonacci(n-2)
\`\`\`

JavaScript:
\`\`\`javascript
const fibonacci = n => n <= 1 ? n : fibonacci(n-1) + fibonacci(n-2);
\`\`\``;
            }
            return 'T√¥i l√† JACK AI - T√¥i c√≥ th·ªÉ gi√∫p b·∫°n gi·∫£i b√†i t·∫≠p, vi·∫øt code, gi·∫£i th√≠ch AI/ML. B·∫°n c·∫ßn g√¨?';
        }

        // Add message to chat
        function addMessage(content, sender, mode = 'fast') {
            const messagesArea = document.getElementById('messagesArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender === 'user' ? 'user-message' : 'bot-message'}`;
            
            let badgeText = '';
            if (sender === 'bot') {
                if (mode === 'fast') badgeText = '‚ö° Suy nghƒ© nhanh';
                else if (mode === 'slow') badgeText = 'üê¢ Suy nghƒ© ch·∫≠m';
                else badgeText = 'üß† Th√¥ng minh';
            }
            
            messageDiv.innerHTML = `
                ${sender === 'bot' ? `<span class="thinking-badge">${badgeText}</span>` : ''}
                <p>${content.replace(/\n/g, '<br>')}</p>
                <div class="message-time">${new Date().toLocaleTimeString()}</div>
            `;
            
            messagesArea.appendChild(messageDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        // Show typing indicator
        function showTypingIndicator() {
            const messagesArea = document.getElementById('messagesArea');
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator';
            indicator.id = 'typingIndicator';
            indicator.innerHTML = `
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            `;
            messagesArea.appendChild(indicator);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        // Remove typing indicator
        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        // Upload image
        function uploadImage() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(readerEvent) {
                        addImagePreview(readerEvent.target.result);
                        uploadedFiles.push({ name: file.name, data: readerEvent.target.result, type: 'image' });
                        showNotification(`üì∑ ƒê√£ t·∫£i: ${file.name}`, 'success');
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        // Upload file
        function uploadFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.pdf,.doc,.docx,.txt,.js,.py';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    uploadedFiles.push({ name: file.name, type: 'file' });
                    showNotification(`üìé ƒê√£ t·∫£i: ${file.name}`, 'success');
                    document.getElementById('userInput').value += `[File: ${file.name}] `;
                }
            };
            input.click();
        }

        // Add image preview
        function addImagePreview(src) {
            const preview = document.getElementById('uploadPreview');
            const item = document.createElement('div');
            item.className = 'preview-item';
            item.innerHTML = `<img src="${src}"><button onclick="this.parentElement.remove()">√ó</button>`;
            preview.appendChild(item);
        }

        // Quick question
        function quickQuestion(question) {
            document.getElementById('userInput').value = question;
            sendMessage();
        }

        // Save to history
        function saveToHistory(question, answer) {
            if (!currentUser) return;
            
            const history = {
                id: Date.now(),
                question: question.substring(0, 30) + (question.length > 30 ? '...' : ''),
                time: new Date().toLocaleString(),
                messages: [
                    { role: 'user', content: question },
                    { role: 'assistant', content: answer }
                ]
            };
            
            chatHistory.unshift(history);
            if (chatHistory.length > 20) chatHistory.pop();
            
            localStorage.setItem(`chatHistory_${currentUser.email}`, JSON.stringify(chatHistory));
            loadUserChatHistory();
        }

        // Load chat
        function loadChat(chatId) {
            const chat = chatHistory.find(c => c.id === chatId);
            if (chat) {
                const messagesArea = document.getElementById('messagesArea');
                messagesArea.innerHTML = '';
                chat.messages.forEach(msg => {
                    addMessage(msg.content, msg.role === 'user' ? 'user' : 'bot');
                });
            }
        }

        // Change avatar (admin only)
        function changeAvatar() {
            if (!isAdmin) {
                showNotification('‚ùå Ch·ªâ admin m·ªõi ƒë∆∞·ª£c ƒë·ªïi avatar!', 'error');
                return;
            }
            
            const input = document.getElementById('avatarInput');
            input.click();
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(readerEvent) {
                        const url = readerEvent.target.result;
                        
                        document.getElementById('mainAvatarImg').src = url;
                        document.getElementById('sidebarAvatarImg').src = url;
                        document.getElementById('headerAvatarImg').src = url;
                        
                        localStorage.setItem('jackAvatar', url);
                        showNotification('‚úÖ ƒê√£ c·∫≠p nh·∫≠t avatar!', 'success');
                    };
                    reader.readAsDataURL(file);
                }
            };
        }

        // Change cover (admin only)
        function changeCover() {
            if (!isAdmin) {
                showNotification('‚ùå Ch·ªâ admin m·ªõi ƒë∆∞·ª£c ƒë·ªïi ·∫£nh b√¨a!', 'error');
                return;
            }
            
            const input = document.getElementById('coverInput');
            input.click();
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(readerEvent) {
                        const url = readerEvent.target.result;
                        
                        document.getElementById('coverImage').style.background = `url('${url}') center/cover`;
                        localStorage.setItem('jackCover', url);
                        showNotification('‚úÖ ƒê√£ c·∫≠p nh·∫≠t ·∫£nh b√¨a!', 'success');
                    };
                    reader.readAsDataURL(file);
                }
            };
        }

        // Admin chat functions
        function openAdminChat() {
            document.getElementById('adminChatModal').classList.add('active');
        }

        function closeAdminChat() {
            document.getElementById('adminChatModal').classList.remove('active');
        }

        function sendAdminMessage() {
            const input = document.getElementById('adminMessageInput');
            const message = input.value.trim();
            
            if (message) {
                const adminMessages = document.getElementById('adminMessages');
                
                const userMsg = document.createElement('div');
                userMsg.className = 'message user-message';
                userMsg.style.maxWidth = '100%';
                userMsg.innerHTML = `<p>${message}</p><div class="message-time">${new Date().toLocaleTimeString()}</div>`;
                adminMessages.appendChild(userMsg);
                
                setTimeout(() => {
                    const reply = document.createElement('div');
                    reply.className = 'message bot-message';
                    reply.style.maxWidth = '100%';
                    reply.innerHTML = `<p>Admin s·∫Ω ph·∫£n h·ªìi s·ªõm!</p><div class="message-time">${new Date().toLocaleTimeString()}</div>`;
                    adminMessages.appendChild(reply);
                    adminMessages.scrollTop = adminMessages.scrollHeight;
                }, 1000);
                
                input.value = '';
                adminMessages.scrollTop = adminMessages.scrollHeight;
            }
        }

        // Toggle theme
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const toggle = document.getElementById('themeToggle');
            toggle.innerHTML = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è Dark/Light' : 'üåô Dark/Light';
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }

        // Toggle sidebar
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        // Show notification
        function showNotification(message, type) {
            const notif = document.createElement('div');
            notif.style.cssText = `
                position: fixed;
                top: 70px;
                right: 20px;
                padding: 0.8rem 1.5rem;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                color: white;
                border-radius: 10px;
                z-index: 3000;
                animation: slideIn 0.3s;
            `;
            notif.textContent = message;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 3000);
        }

        // Event listeners
        document.getElementById('userInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        document.getElementById('changeAvatarBtn').addEventListener('click', changeAvatar);
        document.getElementById('changeCoverBtn').addEventListener('click', changeCover);
    </script>
</body>
</html>
